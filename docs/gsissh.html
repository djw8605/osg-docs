<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>OSG Documentation</title>

        <link rel="stylesheet" href="https://djw8605.github.io/osg-docs/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://djw8605.github.io/osg-docs/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://djw8605.github.io/osg-docs/css/highlight.dark.css">
        <link rel="stylesheet" href="https://djw8605.github.io/osg-docs/css/main.css">
    </head>
    <body>

        <header class="navbar navbar-default navbar-fixed-top">

            <a class="navbar-brand" href="https://djw8605.github.io/osg-docs/">
                OSG Documentation
                <small class="hidden-xs hidden-sm">
                    All you want to know about the OSG
                </small>
            </a>

                            <a href="https://github.com/djw8605/osg-docs">
                    <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
                </a>
            
        </header>

        <main class="container-fluid">
            <div class="row">

                
                    <nav id="sidebar" class="col-sm-3 col-lg-2" role="navigation">

                        <ul class="nav nav-pills nav-stacked">
                                                            <li class="">
                                    <a href="https://djw8605.github.io/osg-docs/docs/Computing_Element/htcondor_ce.html">
                                        HTCondor-CE
                                    </a>
                                </li>
                                                            <li class="">
                                    <a href="https://djw8605.github.io/osg-docs/docs/Frontier_Squid/squid.html">
                                        HTTP Cache (squid)
                                    </a>
                                </li>
                                                    </ul>

                    </nav>

                
                <section id="content" class="col-sm-offset-3 col-lg-offset-2 col-sm-9 col-lg-10">
                    <h1 id="installing-gsi-openssh">Installing GSI OpenSSH</h1>
<p>This document gives instructions on installing and using the GSI OpenSSH server available in the OSG repository and configuring it so that you can use on your cluster.</p>
<h1 id="requirements">Requirements</h1>
<h2 id="host-and-os">Host and OS</h2>
<p>The GSI OpenSSH rpms will require an user account and group in order for the privilege separation to work.</p>
<h2 id="users-and-groups">Users and Groups</h2>
<p>The RPM installation will try to create the <code>gsisshd</code> user and group and the <code>/var/empty/gsisshd</code> directory with the correct ownership if they are not present. If you are using a configuration management system or ROCKS, you should make sure that these users and groups are created before installing the RPMs to avoid potential issues. The gsisshd user should have an empty home directory. By default, this is home directory set to <code>/var/empty/gsisshd</code> and belongs to the <code>gsisshd</code> user and group. You may change it if needed to something else as long as the ownerships remain the same.</p>
<h2 id="networking">Networking</h2>
<p>You'll find more client specific details also in the <a href="#Firewall_Considerations">Firewall section</a> of this document.</p>
<h1 id="installation-procedure">Installation procedure</h1>
<p>Prior to install, make sure you have:</p>
<ul>
<li><a href="../Common/yum.html">Yum repositories correctly configured</a> for OSG.</li>
<li><a href="../Common/ca.html">CA certificates installed</a></li>
</ul>
<h2 id="gsi-openssh-installation">GSI OpenSSH Installation</h2>
<p>Start with installing GSI OpenSSH from the repository</p>
<pre><code class="language-rootscreen">yum install gsi-openssh-server gsi-openssh-clients</code></pre>
<p>In addition, you'll need to install CA certificates in order for GSIOpenSSH to work. You can follow the instructions below in order to install them:</p>
<h1 id="configuration-and-operations">Configuration and Operations</h1>
<h2 id="useful-configuration-and-log-files">Useful configuration and log files</h2>
<p>Configuration Files</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Service or Process</th>
<th style="text-align: left;">Configuration File</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">gsisshd</td>
<td style="text-align: left;"><code>/etc/gsissh/sshd_config</code></td>
<td style="text-align: left;">Configuration file</td>
</tr>
<tr>
<td style="text-align: left;">gsisshd</td>
<td style="text-align: left;"><code>/etc/sysconfig/gsisshd</code></td>
<td style="text-align: left;">Environment variables for gsisshd</td>
</tr>
<tr>
<td style="text-align: left;">gsisshd</td>
<td style="text-align: left;"><code>/etc/lcmaps.db</code></td>
<td style="text-align: left;">LCMAPS configuration</td>
</tr>
</tbody>
</table>
<p>Log Files</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Service or Process</th>
<th style="text-align: left;">Log File</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">gsisshd</td>
<td style="text-align: left;"><code>/var/log/messages</code></td>
<td style="text-align: left;">All log messages</td>
</tr>
</tbody>
</table>
<p>Other Files</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Service or Process</th>
<th style="text-align: left;">File</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">gsisshd</td>
<td style="text-align: left;"><code>/etc/grid-security/hostcert.pem</code></td>
<td style="text-align: left;">Host certificate</td>
</tr>
<tr>
<td style="text-align: left;">gsisshd</td>
<td style="text-align: left;"><code>/etc/grid-security/hostcert.pem</code></td>
<td style="text-align: left;">Key certificate</td>
</tr>
<tr>
<td style="text-align: left;">gsisshd</td>
<td style="text-align: left;"><code>/etc/gsissh/ssh_host_rsa_key</code></td>
<td style="text-align: left;">RSA Host key</td>
</tr>
</tbody>
</table>
<h2 id="configuration">Configuration</h2>
<h2 id="configuration-1">Configuration</h2>
<p>In order to get a running instance of the GSI OpenSSH server, you'll
need to change the default configuration. However, before you go any
further, you'll need to decide whether you want GSI OpenSSH to be your
primary ssh service or not (e.g. whether the GSI OpenSSH service will
replace your existing SSH service). If you choose not to replace your
existing service, you'll need to change the port setting in the GSI
OpenSSH configuration to another port (e.g. 2222) so that you can run
both SSH services at the same time. Regardless of your choice, you
should probably have both services use the same host key. In order
to do this, symlink <code>/etc/gsissh/ssh_host_dsa_key</code> and <code>/etc/gsissh/ssh_host_rsa_key</code>
to <code>/etc/ssh/ssh_host_dsa_key</code> and <code>/etc/ssh/ssh_host_rsa_key</code> respectively. </p>
<p>!!! note
Regardless of the authorization method used for the user, any
account that will be used with GSI OpenSSH must have a shell
assigned to it and not be locked (have ! in the password field of <code>/etc/shadow</code>).</p>
<h2 id="using-a-gridmap-file-for-authorization">Using a gridmap file for authorization</h2>
<p>In order to use gsissh, you'll need to create mappings in your
<code>/etc/grid-security/grid-mapfile</code> for the DNs that you will
allow to login. The mappings should be entered one to a line,
with each line consisting of DN followed by the account the DN
should map to. Also, you should ensure that the
<code>/etc/grid-security/gsi-authz.conf</code> file is empty or that all
of the lines in the file are commented out using a <code>#</code> at the beginning of the line.</p>
<p>!!! note
The mappings will not consider VOMS extensions so the first mapping that matches will be used regardless of the VO role or VO present in the users proxy</p>
<p>An example of the <code>/etc/grid-security/grid-mapfile</code> follows:</p>
<pre><code class="language-file">"/DC=org/DC=doegrids/OU=People/CN=USER NAME 123456" useraccount</code></pre>
<h2 id="using-lcmaps-and-gums-for-authorization">Using LCMAPS and GUMS for authorization</h2>
<p>In order to use LCMAPS callouts with GSI OpenSSH, you'll first need to edit <code>/etc/grid-security/gsi-authz.conf</code> to indicate that Globus should do a GSI callout for authorization. The file should contain the following:</p>
<pre><code class="language-file">globus_mapping liblcas_lcmaps_gt4_mapping.so lcmaps_callout</code></pre>
<p>so that LCMAPS is used. Next, install the lcmaps rpms:</p>
<pre><code class="language-rootscreen">yum install lcmaps lcas-lcmaps-gt4-interface</code></pre>
<p>Finally, you'll need to modify <code>/etc/lcmaps.db</code> so that the <code>gumsclient</code> entry has the correct endpoint for your gums server.</p>
<h2 id="starting-and-enabling-services">Starting and Enabling Services</h2>
<p>To start the services:</p>
<ol>
<li>
<p>To start GSI OpenSSH you can use the service command, e.g.:</p>
<pre><code> service gsisshd start</code></pre>
</li>
</ol>
<p>You should also enable the appropriate services so that they are automatically started when your system is powered on:</p>
<ul>
<li>To enable OpenSSH by default on the node: \<pre class=“rootscreen”\></li>
</ul>
<p><span class="twiki-macro UCL_PROMPT_ROOT"></span> /sbin/chkconfig gsisshd on \&lt;/pre></p>
<h2 id="stopping-and-disabling-services">Stopping and Disabling Services</h2>
<p>To stop the services:</p>
<ol>
<li>
<p>To stop OpenSSH you can use: \<pre class=“rootscreen”\></p>
<pre><code class="language-screen">service gsisshd stop</code></pre>
</li>
</ol>
<p>In addition, you can disable services by running the following commands. However, you don't need to do this normally.</p>
<ul>
<li>Optionally, to disable OpenSSH: \<pre class=“rootscreen”\></li>
</ul>
<p><span class="twiki-macro UCL_PROMPT_ROOT"></span> /sbin/chkconfig gsisshd off \&lt;/pre></p>
<h1 id="troubleshooting">Troubleshooting</h1>
<p>You can get information on troubleshooting errors on the <a href="http://grid.ncsa.illinois.edu/ssh/ts_server.html">NCSA page</a>.</p>
<p>To troubleshoot LCMAPS authorization, you can add the following to <code>/etc/sysconfig/gsisshd</code> and choose a higher debug level:</p>
<pre><code class="language-file"># level 0: no messages, 1: errors, 2: also warnings, 3: also notices,
#  4: also info, 5: maximum debug
LCMAPS_DEBUG_LEVEL=2</code></pre>
<p>Output goes to <code>/var/log/messages</code> by default.</p>
<h2 id="test-gsi-openssh">Test GSI OpenSSH</h2>
<p>After starting the <code>gsisshd</code> service you can check if it is running correctly</p>
<pre><code class="language-screen">$ grid-proxy-init
Your identity: /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=User Name
Enter GRID pass phrase for this identity:
Creating proxy ............................................................................................... Done
Your proxy is valid until: Sat Apr 23 08:18:27 2016
$ gsissh localhost -p 2222
Last login: Tue Sep 18 16:08:03 2012 from itb4.uchicago.edu
$</code></pre>
<h1 id="how-to-get-help">How to get Help?</h1>
<p>To get assistance please use this <a href="HelpProcedure">Help Procedure</a>.</p>
                </section>

            </div>
        </main>

        <footer>
            <div class="container-fluid">
                <p class="text-muted">
                    website generated with <a href="http://couscous.io" title="Markdown website generator">Couscous</a>
                </p>
            </div>
        </footer>

        <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <script src="//yastatic.net/highlightjs/8.2/highlight.min.js"></script>

        <script>
            $(function() {
                $("section>h1").wrap('<div class="page-header" />');
                // Syntax highlighting
                hljs.initHighlightingOnLoad();
            });
        </script>

    </body>
</html>
